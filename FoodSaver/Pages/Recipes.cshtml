@page "/Recipes"
@Html.AntiForgeryToken()
@using FoodSaver.Data
@model FoodSaver.Pages.RecipesModel
@{
    ViewData["Title"] = "Recipes Hub";
    ViewData["Ingradients"] = new List<Ingradient>();
}
<script>
    let ingredientsList = [];
    let recipesIds = [];
    var token = $('[name="__RequestVerificationToken"]').val();
</script>

<!-- ======= Header ======= -->
<header id="header" class="fixed-top d-flex align-items-center">
    <div class="container">
        <div class="header-container d-flex align-items-center justify-content-between">
            <div class="logo">
                <h1 class="text-light"><a href="index.html"><span>Food Saver</span></a></h1>
                <!-- Uncomment below if you prefer to use an image logo -->
                <!-- <a href="index.html"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->
            </div>

            <nav id="navbar" class="navbar" style="margin-right: 5rem">
                <ul>
                    <li><a class="nav-link" href="/">Home</a></li>
                    <li><a class="nav-link" href="/Donation">Donation Points</a></li>
                    <li><a class="nav-link" href="/Reminder">Expire Reminder</a></li>
                    <li><a class="nav-link active" href="/Recipes">Recipes Hub</a></li>
                    <li><a class="nav-link" href="/Planner">Meal Planner</a></li>
                </ul>
                <i class="bi bi-list mobile-nav-toggle"></i>
            </nav><!-- .navbar -->

        </div><!-- End Header Container -->
    </div>
</header><!-- End Header -->

<main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <section class="breadcrumbs">
        <div class="container">

            <div class="d-flex justify-content-between align-items-center">
                <h2>Recipes Hub</h2>
                <ol>
                    <li><a href="/">Home</a></li>
                    <li>Recipes Hub</li>
                </ol>
            </div>

        </div>
    </section><!-- End Breadcrumbs -->

    

    <section id="contact" class="contact">
        <div class="container" >
            <div class="row" >
                <div class="col-lg-4" data-aos="fade-right">
                    <div class="section-title">
                        <h2>Recipes</h2>
                        <p>Search and add your ingradients to list then click Search Recipes button to fetch cooking recipes based on ingradients you have.</p>
                    </div>
                </div>
                <div class="col-lg-5" data-aos="fade-up" data-aos-delay="100">
                    <form class="shadow-form mt-4" style="height: 15rem" id="addIngredient">
                        <h5>Search Ingradient</h5>
                        <div class="form-group mt-3">
                            <input type="text" class="form-control" id="ingradient" placeholder="Type an ingradient ...">
                            <div id="autocomplete-results"></div>
                        </div>

                        <script>
                            const inputEl = document.getElementById('ingradient');
                            const resultList = document.getElementById('autocomplete-results');
                            var token = $('[name="__RequestVerificationToken"]').val();

                            inputEl.addEventListener('input', function () {
                                resultList.style.display = 'none';

                                if (inputEl.value.trim().length > 0) {
                                        const settings = {
                                            async: true,
                                            crossDomain: true,
                                            url: `https://spoonacular-recipe-food-nutrition-v1.p.rapidapi.com/food/ingredients/autocomplete?query=${inputEl.value}&number=5`,
                                            method: 'GET',
                                            headers: {
                                                'X-RapidAPI-Key': 'bffaa60994mshad99b0c495fe234p1bbc5fjsn7179305ed32f',
                                                'X-RapidAPI-Host': 'spoonacular-recipe-food-nutrition-v1.p.rapidapi.com',
                                                "RequestVerificationToken": token
                                            }
                                        };

                                        $.ajax(settings).done(function (response) {
                                            if (response.length) {
                                                resultList.innerHTML = '';
                                                resultList.style.display = 'block';
                                                response.forEach(ingredient => {
                                                    
                                                    const listItem = document.createElement('p');
                                                    listItem.textContent = ingredient.name;
                                                    listItem.addEventListener('click', function () {
                                                        inputEl.value = ingredient.name;
                                                        resultList.style.display = 'none';
                                                    });
                                                    resultList.appendChild(listItem);
                                                });
                                            }
                                        });
                                }
                            });
                        </script>
                        <div class="text-center">
                            <button type="submit" onclick="addToList()" style="margin-top: 30px">Add to List <i class="bi bi-arrow-right"></i></button>
                        </div>
                    </form>
                    <script>
                        const formElement = document.getElementById('addIngredient');

                        formElement.addEventListener('submit', function (e) {
                            if (inputEl.value.trim() === "") {
                                e.preventDefault(); // Prevent form submission
                            }
                        });
                    </script>
                </div>
                <div class="col-lg-3" data-aos="fade-left" data-aos-delay="100">
                    <div class="shadow-form mt-4" style="height: 15rem">
                        <h5>Ingradient List</h5>
                        <div id="listContainer" style="overflow-y: auto; overflow-x: hidden; height: 10rem" class="mt-3">

                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        
        
    </section>
    <section class="portfolio" style="padding-top: 0 !important;">
        <div class="row" data-aos="fade-up" data-aos-delay="100">
            <div class="col-lg-12 d-flex justify-content-center">
                <button type="submit" class="green-btn" onclick="fetchRecipes()" style="width: 20rem" data-aos="zoom-in" data-aos-delay="100">
                    Search Recipes
                </button>
            </div>
        </div>
        <div class="col-lg-12 d-flex justify-content-center mt-3">
            <h5 id="resultTile"></h5>
        </div>
        <div class="container" style="margin-top: 30px; margin-bottom: 60px">
            <div class="row" id="recipesContainer"></div>
        </div>
    </section>

</main><!-- End #main -->
<!--

<section id="contact" class="contact">
    <div class="container">
        <div class="row">
            <div class="col-lg-4" data-aos="fade-right">
                <div class="section-title">
                    <h2>Contact</h2>
                    <p>Magnam dolores commodi suscipit. Necessitatibus eius consequatur ex aliquid fuga eum quidem. Sit sint consectetur velit. Quisquam quos quisquam cupiditate. Et nemo qui impedit suscipit alias ea. Quia fugiat sit in iste officiis commodi quidem hic quas.</p>
                </div>
            </div>

            <div class="col-lg-8" data-aos="fade-up" data-aos-delay="100">
                <iframe style="border:0; width: 100%; height: 270px;" src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d12097.433213460943!2d-74.0062269!3d40.7101282!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0xb89d1fe6bc499443!2sDowntown+Conference+Center!5e0!3m2!1smk!2sbg!4v1539943755621" frameborder="0" allowfullscreen></iframe>
                <div class="info mt-4">
                    <i class="bi bi-geo-alt"></i>
                    <h4>Location:</h4>
                    <p>A108 Adam Street, New York, NY 535022</p>
                </div>
                <div class="row">
                    <div class="col-lg-6 mt-4">
                        <div class="info">
                            <i class="bi bi-envelope"></i>
                            <h4>Email:</h4>
                            <p>info@example.com</p>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="info w-100 mt-4">
                            <i class="bi bi-phone"></i>
                            <h4>Call:</h4>
                            <p>+1 5589 55488 55s</p>
                        </div>
                    </div>
                </div>

                <form action="forms/contact.php" method="post" role="form" class="php-email-form mt-4">
                    <div class="row">
                        <div class="col-md-6 form-group">
                            <input type="text" name="name" class="form-control" id="name" placeholder="Your Name" required>
                        </div>
                        <div class="col-md-6 form-group mt-3 mt-md-0">
                            <input type="email" class="form-control" name="email" id="email" placeholder="Your Email" required>
                        </div>
                    </div>
                    <div class="form-group mt-3">
                        <input type="text" class="form-control" name="subject" id="subject" placeholder="Subject" required>
                    </div>
                    <div class="form-group mt-3">
                        <textarea class="form-control" name="message" rows="5" placeholder="Message" required></textarea>
                    </div>
                    <div class="my-3">
                        <div class="loading">Loading</div>
                        <div class="error-message"></div>
                        <div class="sent-message">Your message has been sent. Thank you!</div>
                    </div>
                    <div class="text-center"><button type="submit">Send Message</button></div>
                </form>
            </div>
        </div>

    </div>
</section>-->